!function(){function i(i){i.find(".ico").on("click",function(){var i=$(this);i.hasClass("icon-d-eye-close")?(i.addClass("icon-d-eye-open")&&i.removeClass("icon-d-eye-close"),i.siblings("input").attr("type","text")):(i.removeClass("icon-d-eye-open")&&i.addClass("icon-d-eye-close"),i.siblings("input").attr("type","password"))})}var n=$("#mobile"),t=n.parents(".box"),e=$("#captcha"),o=e.parents(".box"),a=$("#password"),r=a.parents(".box"),f=$("#confirm_password"),l=f.parents(".box"),s="",c=!1,d=!1,u=$(".recommend").find("input"),h=$(".recommend"),m=!1,p=!0,b="",v=!1,g=!1;b=wbiao.native.historyUrl?wbiao.native.historyUrl:"/";var y=function(i){return 0==i.length?(t.find("i").html("请输入您的手机号"),d=!1,!1):wbiao.mobileCheck({mobile:i})?(d=!0,s=i,t.find("i").html(""),x(s,!1),void 0):(d=!1,t.find("i").html("请输入正确的手机号码"),!1)},w=function(i,n){return 0==i.length?(o.find("i").html("请输入验证码"),!1):i.length<6||i.length>6?(o.find("i").html("请输入6位数字验证码"),!1):void o.find("i").html("")},C=function(i){if(i.length<6||i.length>22)return r.find("i").html("密码应为6-20位任意字符组合"),!1;r.find("i").html("")},k=function(i,n){if(f.val()!=a.val())return l.find("i").html("两次密码不一致，请检查您的密码"),!1;l.find("i").html("")},x=function(i,n,e){$.ajax({type:"post",url:"/member/register/validPhone/",data:{phone:i},dataType:"json",success:function(o){if(o.data.code>0&&!n)return t.find("i").html("手机号码已经被注册，请尝试<a href='/member/login?referrer=/member&phone="+i+"'>登录</a>"),c=!1,p=!1,!1;if(o.data.code<1&&!n)p=!0,c=!0,!!e&&e();else{if(o.data.code<1&&n)return h.find("i").html("该手机号未注册会员"),m=!1,!1;if(o.data.code>0&&n)return h.find("i").html(""),m=!0,!1}}})},j=function(i){var n=$("#getcaptcha");if(g)return!1;$.ajax({type:"post",url:"/member/register/smsCode/",data:{phone:i,verifyCode:$("#imgCaptchaInput").val()},dataType:"json",beforeSend:function(){v=!1,g=!0},success:function(i){if(g=!1,!(i.info.error<1))return o.find("i").html(i.info.message),!1;o.find("i").html("短信已发送,有效时间3分钟"),new wbiao.CountDownClock({seconds:60,funcPerSeconds:function(i){p=!1,n.val("剩余秒数:"+i)},stopCallback:function(){p=!0,n.val("重新发送"),v=!0}}).start()}})};n.on("blur",function(){var i=$(this).val();y(i)}),u.on("blur",function(){var i=$(this).val();return 0==i.length?(h.find("i").html(""),!1):wbiao.mobileCheck({mobile:i})?void x(i,!0):(h.find("i").html("请输入正确的手机号码"),!1)}),$("#imgCaptchaInput").on("focus",function(){$(this).parent("p").siblings("i").empty()}),$("#getcaptcha").on("click",function(){var i=n.val(),e=$("#imgCaptchaInput");if(!e.val())return e.parent("p").siblings("i").text("请填写图形验证码"),!1;if(p){if(!i)return t.find("i").html("请输入您的手机号"),!1;if(!wbiao.mobileCheck({mobile:i}))return t.find("i").html("请输入正确的手机号码"),!1;x(i,!1,function(){j(i)})}}),e.on("blur",function(){var i=$(this).val();n.val();w(i)}),a.on("blur",function(){var i=$(this).val();C(i)}),f.on("blur",function(){$(this).val();k()}),$("#register").on("click",function(){function i(){$.ajax({type:"post",url:"/member/register/register/",data:{password:d,phone:s,recommenderPhone:h,code:m},dataType:"json",success:function(i){if(0==i.info.error)if(0==i.info.data.code)wb.corsAjax({subWbDomain:"gapi",url:"/pub/keywordAsk/",data:{keywordFlag:2,sourceCode:0},complete:function(){window.location.href="/member/register/success?referrer="+b}});else{if(3==i.info.data.code)return $(".graphical").removeClass("h"),o.find("input").focus(),o.find("i").html(i.info.data.message),!1;1==i.info.data.code&&(t.find("input").focus(),t.find("i").html("该手机号已被注册"))}else{if(400==i.info.error)return o.find("input").focus(),o.find("i").html(i.info.message),!1;window.location="/500"}}})}var s=n.val(),c=f.val(),d=a.val(),h=u.val(),m=e.val(),p=$("#identify").val(),v=$("#identify").parents(".box"),g=$(".graphical");if(!s)return t.find("input").focus(),t.find("i").html("请输入您的手机号"),!1;if(!wbiao.mobileCheck({mobile:s}))return t.find("input").focus(),t.find("i").html("请输入正确的手机号码"),!1;if(0==m.length)return o.find("input").focus(),o.find("i").html("请输入验证码"),!1;if(m.length<6||m.length>6)return o.find("input").focus(),o.find("i").html("请输入6位验证码"),!1;if(d.length<6||d.length>22)return r.find("input").focus(),r.find("i").html("密码应为6-20位任意字符组合"),!1;if(c!=d)return l.find("input").focus(),l.find("i").html("两次密码不一致，请检查您的密码"),!1;if(0==g.hasClass("h")){if(!p)return v.find("i").html("请输入图形验证码"),!1;$.ajax({type:"post",url:"/pub/captcha-verify",data:{captcha:p},dataType:"json",success:function(n){if(!n.data.isEqual)return v.find("i").html("请输入正确的图形码"),!1;v.find("i").html(""),i()}})}else i()}),i(r),i(l)}();